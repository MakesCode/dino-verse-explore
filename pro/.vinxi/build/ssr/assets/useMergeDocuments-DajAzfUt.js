import{queryOptions as _,useQuery as M}from"@tanstack/react-query";import{c as C,r as V,ai as Q}from"./ssr-_oDTT3uX.js";import{c as q}from"react/compiler-runtime";import{useDispatch as E}from"react-redux";import{useMatch as j}from"@tanstack/react-router";import{createAction as P}from"@reduxjs/toolkit";function k(){const e=q(1);let a;return e[0]===Symbol.for("react.memo_cache_sentinel")?(a={strict:!1},e[0]=a):a=e[0],j(a).params}const F=C("rentalApprovals/retrieveSubscriptionRentalApprovalsUsecase",async(e,{dispatch:a,extra:t})=>{const{rentalApprovalApi:o}=t;try{return(await o.getSubscriptionRentalApprovals({data:{},params:{rentalApprovalId:e.params.rentalApprovalId,subscriptionId:e.params.subscriptionId}})).payload}catch(r){throw r}}),te=(e,a)=>_({queryKey:["subscription",e.params.subscriptionId,"rentalApproval",e.params.rentalApprovalId],queryFn:async()=>await a?.(F(e)).unwrap()});var K=(e=>(e[e.Owner=1]="Owner",e[e.Tenant=2]="Tenant",e[e.Guarantor=3]="Guarantor",e))(K||{}),f=(e=>(e[e.Uploading=0]="Uploading",e[e.Uploaded=1]="Uploaded",e[e.Validating=2]="Validating",e[e.ManualValid=3]="ManualValid",e[e.AutoValid=4]="AutoValid",e[e.ManualRefuse=5]="ManualRefuse",e[e.AutoRefuse=6]="AutoRefuse",e[e.Removed=7]="Removed",e[e.DoubleCheck=8]="DoubleCheck",e[e.ErrorUpload=9]="ErrorUpload",e[e.Creating=10]="Creating",e))(f||{});const re=["image/jpeg","image/gif","image/png","application/pdf","image/heic"],ne=10,L=C("documents/retrieveMandatoryDocumentsUsecase",async(e,{dispatch:a,extra:t})=>{const{documentsApi:o}=t;try{return(await o.getMandatoryDocuments({data:{},params:e.params})).payload}catch(r){throw r}}),H=(e,a)=>_({queryKey:["mandatory-documents","subscription",e.params.subscriptionId,"rentalApproval",e.params.rentalApprovalId],queryFn:async()=>await a?.(L(e)).unwrap()}),$=P("LIST_DOCUMENT_LOADED"),B=C("document/retrieveDocumentUsecase",async(e,{dispatch:a,extra:t})=>{const{documentsApi:o}=t;try{const r=await o.listDocuments({data:{},params:e.params});return a($({documents:r.payload,params:e.params})),r.payload}catch(r){throw r}}),N=(e,a)=>_({queryKey:["documents",e.params.selectId],queryFn:async()=>await a?.(B({data:{},params:e.params})).unwrap()}),R=new Set([f.Uploading,f.Uploaded,f.Validating,f.ManualValid,f.AutoValid,f.DoubleCheck,f.Creating]);function Y(e,a){return!a||!a.others?[]:a.others.map(t=>{const o=t.requestedDocument.type,d=e.filter(c=>c.documentType===o&&R.has(c.status)).map(c=>{const n=a.rejectedDocuments.find(s=>s.documentId===c.id);return{...c,reason:n?.reason}}),u=d.filter(c=>!c.reason).length;return{...t,uploadedDocuments:d,count:u,isComplete:u>=t.minRequired}})}function Z(e,a){return a?a.entitiesMandatoryDocuments.map(t=>{const o=t.person.id,r=t.requiredDocuments.map(n=>{const s=n.requestedDocument.type,y=e.filter(p=>p.ownerProfileId===o&&p.documentType===s&&R.has(p.status)).map(p=>{const m=a.rejectedDocuments.find(h=>h.documentId===p.id);return{...p,reason:m?.reason}}),i=y.filter(p=>!p.reason).length;return{...n,uploadedDocuments:y,count:i,isComplete:i>=n.minRequired}}),d=r.filter(n=>n.isComplete).length,v=r.length,u=r.reduce((n,s)=>n+s.count,0),c=r.reduce((n,s)=>n+s.minRequired,0);return{...t,requiredDocuments:r,completedTypes:d,totalTypes:v,totalUploaded:u,totalRequired:c}}):[]}const oe=()=>{const e=q(33),a=E(),t=k();let o;e[0]!==a?(o=V({data:{},params:{}},a),e[0]=a,e[1]=o):o=e[1];const r=o,{data:d}=M(r);let v;e[2]!==a||e[3]!==t.ID_rentalapproval||e[4]!==d?.id?(v=H({data:{},params:{rentalApprovalId:t.ID_rentalapproval,subscriptionId:d?.id}},a),e[2]=a,e[3]=t.ID_rentalapproval,e[4]=d?.id,e[5]=v):v=e[5];const u=v,c=d?.id;let n;e[6]!==a||e[7]!==t.ID_rentalapproval||e[8]!==c?(n=N({params:{selectId:t.ID_rentalapproval,rentalApprovalId:t.ID_rentalapproval,subscriptionId:c,documentHolderType:Q.MilaTenant}},a),e[6]=a,e[7]=t.ID_rentalapproval,e[8]=c,e[9]=n):n=e[9];const s=n,A=!!d?.id;let y;e[10]!==s||e[11]!==A?(y={...s,enabled:A},e[10]=s,e[11]=A,e[12]=y):y=e[12];const{data:l}=M(y),{data:i}=M(u);let p,m;e[13]!==l?(m=l||[],e[13]=l,e[14]=m):m=e[14];let h;e[15]!==i||e[16]!==m?(h=Z(m,i),e[15]=i,e[16]=m,e[17]=h):h=e[17],p=h;const D=p;let O,g;e[18]!==l?(g=l||[],e[18]=l,e[19]=g):g=e[19];let I;e[20]!==i||e[21]!==g?(I=Y(g,i),e[20]=i,e[21]=g,e[22]=I):I=e[22],O=I;const T=O;let b;e[23]!==D?(b=()=>!(D.filter(J).length>0),e[23]=D,e[24]=b):b=e[24];const w=b;let U;return e[25]!==l||e[26]!==i||e[27]!==D||e[28]!==T||e[29]!==u||e[30]!==s||e[31]!==w?(U={mergeDocuments:D,othersDocuments:T,documents:l,documentsMandatory:i,mandatoryDocumentQueryOption:u,documentsQueryOption:s,validateDocuments:w},e[25]=l,e[26]=i,e[27]=D,e[28]=T,e[29]=u,e[30]=s,e[31]=w,e[32]=U):U=e[32],U};function z(e){return e.count<e.minRequired}function J(e){return e.requiredDocuments.some(z)}export{re as A,f as D,K as G,k as a,N as b,ne as c,te as r,oe as u};
